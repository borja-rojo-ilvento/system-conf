---
id: task-018
title: Resolve GTK configuration file conflicts in Home Manager
status: In Progress
assignee: []
created_date: '2025-11-15 16:47'
updated_date: '2025-11-15 16:49'
labels: []
dependencies: []
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Home Manager is failing to activate because it's trying to clobber existing GTK configuration files:
- /home/brojo/.gtkrc-2.0
- /home/brojo/.config/gtk-4.0/gtk.css
- /home/brojo/.config/gtk-4.0/settings.ini
- /home/brojo/.config/gtk-3.0/gtk.css
- /home/brojo/.config/gtk-3.0/settings.ini

These files are managed by Home Manager configurations that need to be removed or consolidated. The approach is to:
1. Identify and remove the conflicting configurations from the codebase
2. Generate expected configuration files in a new `new_config/` directory at the root showing what should be manually placed
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 Home Manager activates without clobber errors
- [ ] #2 GTK configuration files are correctly managed by Home Manager's gtk module
- [ ] #3 new_config/ directory documents expected file structure
<!-- AC:END -->

## Implementation Notes

<!-- SECTION:NOTES:BEGIN -->
## Root Cause
Home Manager was attempting to manage GTK configuration files in two conflicting ways:
1. Via the `gtk` module (lines 4-101 in `lib/users/brojo/programs/theming.nix`)
2. Via `xdg.configFile` entries (previously lines 150-165)

This dual configuration caused Home Manager to try to clobber the same files, resulting in the activation failure.

## Resolution Applied
Removed the duplicate `xdg.configFile` configuration block from `lib/users/brojo/programs/theming.nix` that was redundantly defining:
- `gtk-3.0/settings.ini`

The `gtk` module already generates all necessary GTK configuration files:
- `.gtkrc-2.0`
- `.config/gtk-3.0/settings.ini`
- `.config/gtk-3.0/gtk.css`
- `.config/gtk-4.0/settings.ini`
- `.config/gtk-4.0/gtk.css`

## Artifacts
Created `new_config/` directory at repository root showing the expected GTK configuration file structure that will be generated by Home Manager. This serves as reference documentation for what Home Manager will produce when `gtk` module activates.

## Changes Made
- **File Modified**: `lib/users/brojo/programs/theming.nix` - Removed lines 149-165 (duplicate xdg.configFile entries)
- **Directory Created**: `new_config/` with complete GTK configuration structure and README

## Next Steps
Test the configuration with `sudo nixos-rebuild switch --flake .#jaro` to verify Home Manager activates without file conflicts.
<!-- SECTION:NOTES:END -->
